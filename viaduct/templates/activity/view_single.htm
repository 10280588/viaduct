{% from "macros/maps.htm" import render_map %}
{% from "macros/custom_form.htm" import user_fields %}

{% extends "content.htm" %}

{% block content %}

<div class="page-header">
	{% if GroupPermissionAPI.can_write('activity') %}
	<a href="/activities/edit/{{ activity.id }}" class="btn btn-warning pull-right">
		<i class="icon-pencil"></i> 
		Aanpassen
	</a>
	{% endif %}

	<h1>{{activity.name}}</h1>
</div>

<div class="accordion" id="acc">
	<div class="accordion-group">

		<div class="accordion-heading">
			<a class="accordion-toggle" data-toggle="collapse" data-parent="#acc" href="#collapseLocation">
				<i class="icon-compass"></i>
				Locatie: {{ activity.location}}
				<span class="pull-right">Klik om uit te klappen</span>
			</a>
		</div>

		<div id="collapseLocation" class="accordion-body collapse">
			<div class="accordion-inner">
				{{ render_map(600, 400, activity.location) }}
			</div>
		</div>

	</div>
</div>

<div class="row-fluid">
	<div class="span8">
		<h4>Prijs: 
		{% if not activity.price == "gratis"  %}
			<i class="icon-euro"></i>
		{% endif %}
		{{ activity.price }}
		</h4>
		
		<div class="time">
			<i class="icon-calendar"></i>
			{{ activity.get_time() }}
		</div>

		<hr>

		{% if activity.form %}
			{% if current_user.is_active %}
			<form id="custom" action="/forms/submit/{{ activity.form.id }}" enctype="multipart/form-data">

				{{ user_fields(current_user) }}
				{{ activity.form.html | safe }}

				<button id="custom_form" class="btn btn-success">Verzend formulier</button>
			</form>

			{% if activity.form_data %}
				<script src="/static/js/unserialize.js"></script>
				<script>
					$("#custom").unserializeForm("{{ activity.form_data | safe }}");
				</script>
			{% endif %}
			
			<script src="/static/js/custom_form_submission.js"></script>
			{% else %}

				<p>Je moet ingelogd zijn om het formulier in te vullen
				<a href="{{ url_for('user.sign-in') }}">Inloggen</a>
			{% endif %}
		<hr>
		{% endif %}

		<p>{{ activity.description | markdown }}</p>
	</div>

	<div class="span4">
		<img src="/static/activity_pictures/{{ activity.picture }}">
	</div>
</div>

{% endblock %}
